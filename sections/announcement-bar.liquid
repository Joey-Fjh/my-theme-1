<div 
  class="full-width color-{{ section.settings.color_scheme }}"
  data-section-id="{{ section.id }}" 
  data-auto-play="{{ section.settings.auto_play }}"
  data-change-play-speed="{{ section.settings.change_play_speed }}"
  data-init="false"
>
  <div
    class="shopify-section"
  >
    <div class="flex items-center px-4 py-2 text-sm">
      <div class="flex items-center shrink-0 mr-6">
        {%- if section.settings.show_social -%}
          {%- render 'social-icons', size: 'small' -%}
        {%- endif -%}
      </div>

      <div class="flex-1 overflow-hidden text-center shrink-0">
        {%- if section.blocks.size > 0 -%}
          <div class="swiper-container">
            <div class="swiper-wrapper">
              {%- for block in section.blocks -%}
                <div class="swiper-slide" {{ block.shopify_attributes }}>
                  {%- if block.settings.link != blank -%}
                    <a href="{{ block.settings.link }}" class="inline-block hover:underlink">
                      {{ block.settings.text }}
                    </a>
                  {%- else -%}
                    <span>{{ block.settings.text }}</span>
                  {%- endif -%}
                </div>
              {%- endfor -%}
            </div>
          </div>
        {%- endif -%}
      </div>

      <div class="flex items-center shrink-0 ml-6 space-x-4">
        {%- if section.settings.enable_country_selector -%}
          <div class="country-selector">
            <span>Country/Region</span>
          </div>
        {%- endif -%}
        {%- if section.settings.enable_language_selector -%}
          <div class="language-selector">
            <span>English</span>
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded',() => {
    const announcementBar = document.querySelector(`[data-section-id="{{ section.id }}"]`);
    
    if(!announcementBar || announcementBar.dataset.init === 'true') return;

    announcementBar.dataset.init = 'true';

    const autoPlay = announcementBar.dataset.autoPlay === 'true';
    const changePlaySpeed = parseInt(announcementBar.dataset.changePlaySpeed) || 5;

    const swiperContainer = announcementBar.querySelector('.swiper-container');

    if(!swiperContainer || typeof Swiper === 'undefined') return;

    new Swiper(swiperContainer, {
      loop: true,
      autoplay: autoPlay ? {
        delay: changePlaySpeed * 1000,
        disableOnInteraction: false
      } : false,
      slidesPerView: 1,
      allowTouchMove: false,
      effect: 'fade',
      fadeEffect: {
        crossFade: true
      },
      pagination: false,
      navigation: false
    });
  });
</script>

{% schema %}
  {
    "name": "Announcement Bar",
    "tag": "section",
    "class": "section",
    "max_blocks": 6,
    "enabled_on": {
      "groups": ["header"]
    },
    "settings": [
      {
        "type": "header",
        "content": "Announcement bar"
      },
      {
        "type": "checkbox",
        "id": "auto_play",
        "label": "Auto-play announcements",
        "default": false
      },
      {
        "type": "range",
        "id": "change_play_speed",
        "min": 3,
        "max": 10,
        "step": 1,
        "unit": "s",
        "label": "Change play speed",
        "default": 5
      },
      {
        "type": "color_scheme",
        "id": "color_scheme",
        "label": "Color scheme",
        "default": "scheme-1"
      },
      {
        "type": "header",
        "content": "Public settings"
      },
      {
        "type": "paragraph",
        "content": "Only displayed on large screens"
      },
      {
        "type": "checkbox",
        "id": "show_social",
        "default": false,
        "label": "Social icon",
        "info": "[Manage social accounts](/editor?context=theme&category=social%20icon)"
      },
      {
        "type": "checkbox",
        "id": "enable_country_selector",
        "default": false,
        "label": "Country/region selector",
        "info": "[Manage countries/regions](/admin/settings/markets)"
      },
      {
        "type": "checkbox",
        "id": "enable_language_selector",
        "default": false,
        "label": "Language selector",
        "info": "[Manage languages](/admin/settings/languages)"
      }
    ],
    "blocks":[
      {
        "type": "announcement",
        "name": "Announcement",
        "settings": [
          {
            "type": "inline_richtext",
            "id": "text",
            "default":"Welcome to our store!",
            "label": "Text"
          },
          {
            "type": "url",
            "id": "link",
            "label": "Link"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Announcement Bar",
        "blocks": [
          {
            "type": "announcement"
          }
        ]
      }
    ]
  }
{% endschema %}