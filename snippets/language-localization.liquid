{%- comment -%}
  Renders the language picker for the localization form

  Accepts:
    - localPosition: pass in the position in which the form is coming up to create specific IDs
{%- endcomment -%}

{%- assign current_locale = localization.language.iso_code -%}
{%- assign available_locales = localization.available_languages -%}

<div x-data="{ open: false }" @click.away="open = false" class="localization-switcher">
  {% form 'localization', id: localPosition %}
    <button 
      type="button"
      @click="open = !open"
      :aria-expanded="open"
      aria-haspopup="true"
      class="localization-toggle"
    >
      {{ localization.language.endonym_name | capitalize }}
    </button>

    <div 
      x-show="open"
      x-cloak 
      x-transition:enter="transition ease-out duration-200"
      x-transition:enter-start="opacity-0 scale-95"
      x-transition:enter-end="opacity-100 scale-100"
      x-transition:leave="transition ease-in duration-150"
      x-transition:leave-start="opacity-100 scale-100"
      x-transition:leave-end="opacity-0 scale-95"
      class="localization-menu"
    >
      {%- for locale in available_locales -%}
        <div class="localization-item">
          <button
            name="locale_code"
            type="submit"
            value="{{ locale.iso_code }}"
            class="localization-link w-full"
            {%- if locale.iso_code == current_locale %} aria-current="true" {%- endif -%}
          >
            {%- if locale.iso_code == current_locale -%}
              <span>âœ“</span>
            {%- endif -%}
              <span>{{ locale.endonym_name }}</span>
          </button>
        </div>
      {%- endfor -%}
    </div>
  {% endform %}
</div>