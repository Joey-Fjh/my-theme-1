{% doc %}
  Renders a responsive image that might be wrapped in a link.

  When `width`, `height` and `crop` are provided, the image will be rendered
  with a fixed aspect ratio.

  Serves as an example of how to use the `image_url` filter and `image_tag` filter
  as well as how you can use LiquidDoc to document your code.

  @param {image} image - The image to be rendered
  @param {string} [url] - An optional destination URL for the image
  @param {string} [wrapper] - An optional wrapper element, either 'a' or 'div'. If not provided, it will be 'a' if url is provided, otherwise 'div'.
  @param {string} [class] - Optional class to be added to the image wrapper
  @param {string} [img_class] - Optional class to be added to the img tag
  @param {number} [width] - The highest resolution width of the image to be rendered
  @param {number} [height] - The highest resolution height of the image to be rendered
  @param {string} [crop] - The crop position of the image
  @param {string} [widths] - Optional widths for srcset generation (comma-separated list of numbers)
  @param {string} [sizes] - Optional sizes attribute for responsive images
  @param {string} [loading] - Optional loading attribute for the img tag ('lazy' or 'eager')
  @param {string} [decoding] - Optional decoding attribute for the img tag ('async', 'sync' or 'auto')
  @param {string} [alt] - Optional alt text for the image
  @param {string} [aspect_ratio] - Optional aspect ratio for the image (e.g. '16:9') 

  @example
  {% render 'image', image: product.featured_image, url: product.url %}
  {% render 'image',
    image: product.featured_image,
    url: product.url,
    sizes: '(min-width: 1024px) 33vw,50vw',
    loading: 'eager'
  %}
{% enddoc %}

{%- liquid
  if wrapper == blank
    if url != blank
      assign wrapper = 'a'
    else
      assign wrapper = 'div'
    endif
  endif

  if width == blank
    assign width = 1440
  endif

  assign widths = widths | default: '165,360,535,750,1100,1500,2000'
  assign sizes = sizes | default: '100vw'

  assign loading = loading | default: 'lazy'
  assign decoding = decoding | default: 'async'
  assign aspect_ratio = aspect_ratio
  if aspect_ratio == blank and image != blank and image.width and image.height
    assign aspect_ratio = image.width | append: '/' | append: image.height    
  endif

  assign class = class | default: ''
  assign img_class = img_class | default: 'image_img' 
-%}

{% liquid
  unless height
    assign width = width | default: image.width
  endunless

  if url
    assign wrapper = 'a'
  else
    assign wrapper = 'div'
  endif
%}

<{{ wrapper }}
  class="image {%- if class -%} {{ class }} {%- endif -%}"
  {% if url %} href="{{ url }}" {% endif %}
  {%- if aspect_ratio -%} style="--aspect-ratio: {{ aspect_ratio }}" {%- endif -%}
>
  {{ 
    image 
    | image_url: width: width, height: height, crop: crop 
    | image_tag:
      class: img_class,
      alt: alt,
      widths: widths, 
      sizes: sizes,
      loading: loading,
      decoding: decoding
  }}
</{{ wrapper }}>

{% stylesheet %}
  .image {
    display: block;
    position: relative;
    overflow: hidden;
    width: 100%;
    aspect-ratio: var(--aspect-ratio);
    height: 100%;
  }

  .image > .image_img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
{% endstylesheet %}
