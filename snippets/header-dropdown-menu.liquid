{% comment %}
Renders a standard dropdown style menu for the header.

Usage:
{% render 'header-dropdown-menu' %}
{% endcomment %}

<nav 
  class="header-dropdown-menu"
  x-data="dropdown"
  @click.outside="close()"
  @keydown.escape.window="close()"
>
  <ul class="flex items-center gap-6" role="list">
    {%- for link in section.settings.menu.links  -%}
      <li class="relative">
        {%- if link.links != blank -%}
          <details 
            class="dropdown"
            data-dropdown
            data-deep="1"
          >
            <summary
              class="dropdown-trigger flex items-center gap-1"
              id="HeaderMenu-{{ link.handle }}"
              @click.stop.prevent="toggle($el.parentElement)"
            >
              <div class="links links-underline flex items-center gap-3">
                <span>
                  {{ link.title | escape }}
                </span>
                <span class="w-6 h-6 inline-block icons dropdown-icon dropdown-icon--down">
                  {{ 'icon-arrow.svg' | inline_asset_content }}
                </span>
              </div>
            </summary>
            
            <ul class="dropdown-panel dropdown-open mt-2 rounded-md color-{{ section.settings.menu_color_scheme }} p-3"
              role="list"
              tabindex="-1"
            >
              {%- for childlink in link.links -%}
                <li>
                  {%- if childlink.links == blank -%}
                    {% capture childlink_classes %}
                      block px-4 py-2
                      {% if childlink.current %} font-medium{% endif %}
                    {% endcapture %}
                    {%- capture childlink_attributes -%}
                      {%- if childlink.current -%}
                        aria-current="page"
                      {%- endif -%}
                    {%- endcapture -%}

                    {%- render 'link', text: childlink.title | escape , class: childlink_classes, href: childlink.url, variant: "underline", attributes: childlink_attributes -%}
                  {%- else -%}
                    <details 
                      class="dropdown"
                      data-dropdown
                      data-deep="2"
                    >
                      <summary 
                        class="dropdown-trigger flex items-center justify-between px-4 py-2"
                        id="HeaderMenu-{{ childlink.handle }}"
                        @click.stop.prevent="toggle($el.parentElement)"
                      >
                        <div class="links links-underline flex items-center gap-3">
                          <span class="links links-underline">
                            {{ childlink.title | escape }}
                          </span>
                          <span class="w-6 h-6 inline-block icons dropdown-icon dropdown-icon--tilt">
                            {{ 'icon-arrow1.svg' | inline_asset_content }}
                          </span>
                        </div>
                      </summary>
                      
                      <ul class="dropdown-panel dropdown-open ml-2 mt-1 p-3 top-0 left-full color-{{ section.settings.menu_color_scheme }}" role="list">
                        {%- for grandChildLink in childlink.links -%}
                          <li>
                            {%- capture grand_child_link_classes -%}
                              block px-4 py-2 
                              {% if grandChildLink.current %} font-medium {% endif %}
                            {%- endcapture -%}
                            {%- capture grand_child_link_attributes -%}
                              {%- if grandChildLink.current -%}
                                aria-current="page"
                              {%- endif -%}
                            {%- endcapture -%}

                            {%- render 'link', text: grandChildLink.title | escape, class: grand_child_link_classes, href: grandChildLink.url, variant: "underline", attributes: grand_child_link_attributes -%}
                          </li>
                        {%- endfor -%}
                      </ul>
                    </details>
                  {%- endif -%}
                </li>
              {%- endfor -%}
            </ul>
          </details>
        {%- else -%}
          {%- capture link_attributes -%}
            {%- if link.current -%}
              aria-current="page"
            {%- endif -%}
          {%- endcapture -%}

          {%- render 'link', text: link.title | escape, href: link.url, variant: "underline", attributes: link_attributes -%}
        {%- endif -%}
      </li>
    {%- endfor -%}
  </ul>
</nav>
